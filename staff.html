<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Stock Viewer - Staff Mobile</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2"></script>

    <style>
        /* Custom Styles for Mobile smoothness */
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; -webkit-tap-highlight-color: transparent; }
        
        /* Hide Scrollbar but keep functionality */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Smooth Scrolling */
        html { scroll-behavior: smooth; }

        /* Card Animation */
        .stock-card { transition: transform 0.2s ease, box-shadow 0.2s ease; }
        .stock-card:active { transform: scale(0.98); }

        /* Search Input Focus */
        .search-box:focus-within { box-shadow: 0 4px 20px -5px rgba(37, 99, 235, 0.3); border-color: #3b82f6; }

        /* Filter Chip Active State */
        .chip.active { background-color: #0f172a; color: white; border-color: #0f172a; }
    </style>
</head>
<body class="pb-20">

    <header class="fixed top-0 left-0 right-0 bg-white z-50 shadow-sm border-b border-slate-100">
        <div class="px-4 py-3 flex justify-between items-center bg-slate-900">
            <div class="flex items-center gap-2">
                <div class="w-8 h-8 rounded-lg bg-blue-600 flex items-center justify-center text-white font-bold text-sm">TM</div>
                <div>
                    <h1 class="text-sm font-bold text-white leading-tight">Stock Viewer</h1>
                    <p class="text-[10px] text-slate-400">Live Inventory</p>
                </div>
            </div>
            <div class="w-8 h-8 rounded-full bg-slate-800 flex items-center justify-center text-slate-400">
                <i class="fa-solid fa-user text-xs"></i>
            </div>
        </div>

        <div class="px-4 py-3">
            <div class="search-box relative w-full bg-slate-50 border border-slate-200 rounded-xl flex items-center transition-all duration-300">
                <i class="fa-solid fa-magnifying-glass absolute left-4 text-slate-400 text-sm"></i>
                <input type="text" id="globalSearch" placeholder="Search Design, Surface..." class="w-full bg-transparent py-3 pl-10 pr-10 text-sm font-medium text-slate-700 outline-none placeholder-slate-400" oninput="handleSearch(this.value)">
                <button id="clearSearch" class="absolute right-3 text-slate-300 hover:text-slate-500 hidden" onclick="clearSearch()">
                    <i class="fa-solid fa-circle-xmark"></i>
                </button>
            </div>
        </div>

        <div class="border-t border-slate-50">
            <div class="flex gap-2 overflow-x-auto no-scrollbar px-4 py-3" id="sizeFilterContainer">
                </div>
        </div>
        
        <div class="px-4 py-1.5 bg-slate-50 border-t border-slate-100 flex justify-between items-center text-[10px] font-semibold text-slate-400 uppercase tracking-wider">
            <span>Showing: <span id="showingCount" class="text-slate-800">0</span> items</span>
            <span id="activeFilterLabel" class="hidden text-blue-600">Filter Active</span>
        </div>
    </header>

    <div class="h-[185px]"></div>

    <main class="px-3 pt-2" id="mainContainer">
        
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="cardGrid">
            </div>

        <div id="noResults" class="hidden flex-col items-center justify-center py-20 text-center">
            <div class="w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mb-4">
                <i class="fa-solid fa-box-open text-3xl text-slate-300"></i>
            </div>
            <h3 class="text-slate-600 font-bold">No Stock Found</h3>
            <p class="text-sm text-slate-400 mt-1">Try adjusting your search or filters</p>
            <button onclick="resetFilters()" class="mt-4 px-6 py-2 bg-blue-600 text-white text-sm font-bold rounded-full shadow-lg shadow-blue-200">Clear All</button>
        </div>

    </main>

    <div id="imageModal" class="fixed inset-0 z-[100] hidden bg-black/95 backdrop-blur-sm flex items-center justify-center p-4" onclick="closeModal()">
        <button class="absolute top-4 right-4 w-10 h-10 bg-white/10 rounded-full text-white flex items-center justify-center backdrop-blur-md" onclick="closeModal()">
            <i class="fa-solid fa-xmark text-lg"></i>
        </button>
        <div class="relative w-full max-w-lg" onclick="event.stopPropagation()">
            <img id="modalImage" src="" class="w-full h-auto rounded-lg shadow-2xl border border-white/10">
            <div class="absolute bottom-4 left-0 right-0 text-center">
                <span id="modalTitle" class="bg-black/50 text-white px-4 py-1.5 rounded-full text-sm font-bold backdrop-blur-md">Design Name</span>
            </div>
        </div>
    </div>

    <button onclick="window.scrollTo({top:0, behavior:'smooth'})" class="fixed bottom-6 right-6 w-12 h-12 bg-slate-900 text-white rounded-full shadow-xl shadow-slate-900/30 flex items-center justify-center z-40 active:scale-90 transition-transform">
        <i class="fa-solid fa-arrow-up"></i>
    </button>

<script>
    // ==========================================
    // 1. DUMMY DATA GENERATION (Simulating Firebase)
    // ==========================================
    const DUMMY_IMAGES = [
        "https://images.unsplash.com/photo-1620121474603-33c5c8d55590?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80", // Marble 1
        "https://images.unsplash.com/photo-1616464916356-3a777b2b60b1?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80", // Marble 2
        "https://images.unsplash.com/photo-1594818379496-da1e345b0ded?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80", // Texture
        "https://images.unsplash.com/photo-1589939705384-5185137a7f0f?ixlib=rb-4.0.3&auto=format&fit=crop&w=600&q=80"  // Dark
    ];

    const SIZES = ["1200x600", "600x600", "800x800", "1200x1200", "300x450"];
    const SURFACES = ["High Gloss", "Matt", "Carving", "Polished"];
    const BODIES = ["Vitrified", "Ceramic", "GVT", "PGVT"];

    let rawData = [];
    let currentData = [];
    let activeSize = 'All';

    // Generate 100 Random Entries
    function generateDummyData() {
        for(let i=1; i<=100; i++) {
            rawData.push({
                id: i,
                design: `Royal ${SURFACES[Math.floor(Math.random()*SURFACES.length)]} ${i}`,
                size: SIZES[Math.floor(Math.random()*SIZES.length)],
                surface: SURFACES[Math.floor(Math.random()*SURFACES.length)],
                body: BODIES[Math.floor(Math.random()*BODIES.length)],
                crate: `C-${1000 + i}`,
                qty: Math.floor(Math.random() * 500) + 10,
                box: Math.floor(Math.random() * 50) + 5,
                image: DUMMY_IMAGES[Math.floor(Math.random()*DUMMY_IMAGES.length)]
            });
        }
        currentData = [...rawData];
    }

    // ==========================================
    // 2. RENDER FUNCTIONS
    // ==========================================

    function initApp() {
        generateDummyData();
        renderFilters();
        renderCards(currentData);
        
        // Setup Search (Fuse.js)
        window.fuse = new Fuse(rawData, {
            keys: ['design', 'size', 'surface', 'crate'],
            threshold: 0.3
        });
    }

    function renderFilters() {
        const container = document.getElementById('sizeFilterContainer');
        const uniqueSizes = ['All', ...new Set(rawData.map(i => i.size))].sort();
        
        container.innerHTML = uniqueSizes.map(size => `
            <button onclick="filterBySize('${size}')" 
                class="chip ${size === 'All' ? 'active' : ''} whitespace-nowrap px-4 py-1.5 rounded-full border border-slate-200 text-xs font-bold text-slate-500 bg-white shadow-sm transition-all active:scale-95"
                data-size="${size}">
                ${size}
            </button>
        `).join('');
    }

    function renderCards(data) {
        const grid = document.getElementById('cardGrid');
        const countEl = document.getElementById('showingCount');
        const noRes = document.getElementById('noResults');

        grid.innerHTML = '';
        countEl.innerText = data.length;

        if(data.length === 0) {
            noRes.classList.remove('hidden');
            noRes.classList.add('flex');
            return;
        } else {
            noRes.classList.add('hidden');
            noRes.classList.remove('flex');
        }

        // Limit rendering for performance (Lazy Load Simulation)
        const displayData = data.slice(0, 50); 

        displayData.forEach(item => {
            const card = document.createElement('div');
            card.className = "stock-card bg-white rounded-xl shadow-[0_2px_15px_-3px_rgba(0,0,0,0.07),0_10px_20px_-2px_rgba(0,0,0,0.04)] overflow-hidden border border-slate-100 relative";
            
            // Stock Status Indicator (Color based on Qty)
            const stockColor = item.qty > 200 ? 'bg-green-500' : (item.qty > 50 ? 'bg-orange-400' : 'bg-red-500');

            card.innerHTML = `
                <div class="relative h-48 w-full bg-slate-200 overflow-hidden cursor-pointer group" onclick="openModal('${item.image}', '${item.design}')">
                    <img src="${item.image}" loading="lazy" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110">
                    <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-60"></div>
                    
                    <div class="absolute top-3 right-3">
                         <span class="px-2 py-1 rounded-md bg-white/90 backdrop-blur-sm text-[10px] font-bold text-slate-800 shadow-sm border border-white/20">
                            ${item.crate}
                         </span>
                    </div>

                    <div class="absolute bottom-3 left-3 text-white">
                         <div class="text-[10px] font-medium opacity-90 uppercase tracking-widest">${item.surface}</div>
                         <div class="text-lg font-bold leading-tight shadow-black drop-shadow-md">${item.design}</div>
                    </div>
                </div>

                <div class="p-4">
                    <div class="flex flex-wrap gap-2 mb-4">
                        <span class="px-2 py-0.5 rounded text-[10px] font-bold bg-slate-100 text-slate-600 border border-slate-200">${item.size}</span>
                        <span class="px-2 py-0.5 rounded text-[10px] font-bold bg-blue-50 text-blue-600 border border-blue-100">${item.body}</span>
                    </div>

                    <div class="grid grid-cols-2 gap-2 border-t border-slate-50 pt-3">
                        <div class="flex flex-col">
                            <span class="text-[10px] text-slate-400 font-bold uppercase">Available Boxes</span>
                            <span class="text-lg font-bold text-slate-800">${item.qty}</span>
                        </div>
                        <div class="flex flex-col items-end">
                             <span class="text-[10px] text-slate-400 font-bold uppercase">Status</span>
                             <div class="flex items-center gap-1.5 mt-1">
                                <div class="w-2 h-2 rounded-full ${stockColor} animate-pulse"></div>
                                <span class="text-xs font-bold text-slate-600">${item.qty > 0 ? 'In Stock' : 'Out'}</span>
                             </div>
                        </div>
                    </div>
                </div>
            `;
            grid.appendChild(card);
        });
    }

    // ==========================================
    // 3. FILTER & SEARCH LOGIC
    // ==========================================

    function filterBySize(size) {
        activeSize = size;
        
        // Update Chip UI
        document.querySelectorAll('.chip').forEach(c => {
            if(c.dataset.size === size) c.classList.add('active');
            else c.classList.remove('active');
        });

        applyFilters();
    }

    function handleSearch(val) {
        const clearBtn = document.getElementById('clearSearch');
        if(val.length > 0) clearBtn.classList.remove('hidden');
        else clearBtn.classList.add('hidden');
        
        applyFilters();
    }

    function clearSearch() {
        document.getElementById('globalSearch').value = '';
        handleSearch('');
    }

    function applyFilters() {
        const query = document.getElementById('globalSearch').value.trim();
        let data = rawData;

        // 1. Apply Size Filter
        if(activeSize !== 'All') {
            data = data.filter(item => item.size === activeSize);
        }

        // 2. Apply Search Filter
        if(query.length > 0) {
            const results = window.fuse.search(query);
            data = results.map(r => r.item).filter(item => {
                // Ensure size filter is respected within search results
                return activeSize === 'All' || item.size === activeSize;
            });
        }

        renderCards(data);
        
        // UI Feedback
        const filterLabel = document.getElementById('activeFilterLabel');
        if(activeSize !== 'All' || query.length > 0) filterLabel.classList.remove('hidden');
        else filterLabel.classList.add('hidden');
    }

    function resetFilters() {
        document.getElementById('globalSearch').value = '';
        filterBySize('All');
        clearSearch();
    }

    // ==========================================
    // 4. MODAL LOGIC
    // ==========================================

    function openModal(imgSrc, title) {
        const modal = document.getElementById('imageModal');
        document.getElementById('modalImage').src = imgSrc;
        document.getElementById('modalTitle').innerText = title;
        modal.classList.remove('hidden');
        // Prevent body scroll
        document.body.style.overflow = 'hidden';
    }

    function closeModal() {
        const modal = document.getElementById('imageModal');
        modal.classList.add('hidden');
        document.body.style.overflow = 'auto';
    }

    // Initialize
    initApp();

</script>
</body>
</html>
